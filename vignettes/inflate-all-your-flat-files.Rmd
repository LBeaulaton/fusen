---
title: "Inflate all your flat files"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{inflate-all-your-flat-files}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(fusen)
```

<!-- WARNING - This vignette is generated by {fusen} from dev/flat_read_inflate_params.Rmd: do not edit by hand -->

This vignette details the process used to be able to inflate all the flat files present in the `dev/` folder at once.

Prior to be able to inflate all the flat files, some checks are performed.

The function `pre_inflate_all_diagnosis()` performs a diagnosis to assess whether the flat files are available to be used by `inflate_all()`. 

Please note that `inflate_all()` requires the existence of a `config_fusen.yml` file. This file is not existing in versions of {fusen} prior to v0.5.0.9000.

If you are working in a project initiated with a version of {fusen} prior to v0.5.0.9000, please run `inflate()` for at least one of your flat files in order to create the `config_fusen.yml` file.

If you are already familiar to `config_fusen.yml` but were working with a dev version of {fusen} prior to v0.5.0.9001, your `config_fusen.yml` file does not contain inflate-related parameters. You will have to inflate again you flat files in order to complete `config_fusen.yml` with the `inflate()` parameters.



# pre_inflate_all_diagnosis

```{r example-pre_inflate_all_diagnosis, eval = FALSE}
#' \dontrun{
dummypackage <- tempfile("register")
dir.create(dummypackage)
fill_description(pkg = dummypackage, fields = list(Title = "Dummy Package"))
dev_file <-
  suppressMessages(add_minimal(
    pkg = dummypackage,
    overwrite = TRUE,
    open = FALSE
  ))
# let's create 2 flat files
flat_file <- dev_file[grepl("flat_", dev_file)]
flat_file2 <-
  gsub(
    x = flat_file,
    pattern = "flat_minimal.Rmd",
    replacement = "flat_minimal_2.Rmd"
  )
file.copy(
  from = flat_file,
  to = flat_file2,
  overwrite = TRUE
)

# let's inflate them to have dev/config_fusen.yml
suppressMessages(
  inflate(
    pkg = dummypackage,
    flat_file = flat_file,
    vignette_name = "Get started",
    check = FALSE,
    open_vignette = FALSE
  )
)

suppressMessages(
  inflate(
    pkg = dummypackage,
    flat_file = flat_file2,
    vignette_name = "Get started2",
    check = FALSE,
    open_vignette = FALSE
  )
)

config_yml_ref <-
  yaml::read_yaml(file.path(dummypackage, "dev/config_fusen.yaml"))

# all files can be inflated with inflate_all()
config_yml <- config_yml_ref
diag <-
  pre_inflate_all_diagnosis(config_yml = config_yml, pkg = dummypackage)
print(diag)

# let's consider the first flat file is deprecated
config_yml <- config_yml_ref
config_yml[[1]][["state"]] <- "deprecated"
diag <-
  pre_inflate_all_diagnosis(config_yml = config_yml, pkg = dummypackage)
print(diag)

# let's consider the first flat file is missing from config_fusen.yaml
config_yml <- config_yml_ref
config_yml[[1]] <- NULL
diag <-
  pre_inflate_all_diagnosis(config_yml = config_yml, pkg = dummypackage)
print(diag)

# let's consider that the first flat file has not inflate related params in config_fusen.yaml
config_yml <- config_yml_ref
config_yml[[1]][["inflate"]] <- NULL
diag <-
  pre_inflate_all_diagnosis(config_yml = config_yml, pkg = dummypackage)
print(diag)

# let's consider a file is in config.yml but missing from dev/
config_yml <- config_yml_ref
config_yml[["missing_file.Rmd"]] <- config_yml[[1]]
diag <-
  pre_inflate_all_diagnosis(config_yml = config_yml, pkg = dummypackage)
print(diag)

unlink(dummypackage, recursive = TRUE)
#' }
```

```{r examples-read_inflate_params, eval = FALSE}
#' \dontrun{
config_yml <- yaml::read_yaml(system.file("inflate_all/config_fusen_with_inflate_parameters.yaml", package = "fusen"))
read_inflate_params(config_yml = config_yml)
#' }
```

